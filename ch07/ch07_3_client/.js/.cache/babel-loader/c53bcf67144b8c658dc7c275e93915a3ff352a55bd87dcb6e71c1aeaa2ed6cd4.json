{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useCallback } from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport * as LO from \"../store/listidOrders\";\nimport * as L from \"../store/listEntities\";\nimport * as C from \"../store/cardEntities\";\nimport * as LC from \"../store/listidCardidOrders\";\nimport * as U from \"../utils\";\nexport const useLists = () => {\n  _s();\n  const dispatch = useDispatch();\n  const lists = useSelector(({\n    listidOrders,\n    listEntities\n  }) => listidOrders.map(uuid => listEntities[uuid]));\n  const listidCardidOrders = useSelector(({\n    listidCardidOrders\n  }) => listidCardidOrders);\n  const listidOrders = useSelector(({\n    listidOrders\n  }) => listidOrders);\n  const onCreateList = useCallback((uuid, title) => {\n    const list = {\n      uuid,\n      title\n    };\n    dispatch(LO.addListidToOrders(uuid));\n    dispatch(L.addList(list));\n    dispatch(LC.setListidCardids({\n      listid: list.uuid,\n      cardids: []\n    }));\n  }, [dispatch]);\n  const onRemoveList = useCallback(listid => () => {\n    listidCardidOrders[listid].forEach(cardid => {\n      dispatch(C.removeCard(cardid));\n    });\n    dispatch(LC.removeListid(listid));\n    dispatch(L.removeList(listid));\n    dispatch(LO.removeListidFromOrders(listid));\n  }, [dispatch, listidCardidOrders]);\n  const onMoveList = useCallback((dragIndex, hoverIndex) => {\n    const newOrders = listidOrders.map((item, index) => index === dragIndex ? listidOrders[hoverIndex] : index === hoverIndex ? listidOrders[dragIndex] : item);\n    dispatch(LO.setListidOrders(newOrders));\n  }, [dispatch, listidOrders]);\n  const onDragEnd = useCallback(result => {\n    var _result$destination, _result$destination2;\n    console.log(\"onDragEnd result\", result);\n    const destinationListid = (_result$destination = result.destination) === null || _result$destination === void 0 ? void 0 : _result$destination.droppableId;\n    const destinationCardIndex = (_result$destination2 = result.destination) === null || _result$destination2 === void 0 ? void 0 : _result$destination2.index;\n    if (destinationListid === undefined || destinationCardIndex === undefined) return;\n    const sourceListid = result.source.droppableId;\n    const sourceCardIndex = result.source.index;\n    if (destinationListid === sourceListid) {\n      const cardidOrders = listidCardidOrders[destinationListid];\n      dispatch(LC.setListidCardids({\n        listid: destinationListid,\n        cardids: U.swapItemsInArray(cardidOrders, sourceCardIndex, destinationCardIndex)\n      }));\n    } else {\n      const sourceCardidOrders = listidCardidOrders[sourceListid];\n      dispatch(LC.setListidCardids({\n        listid: sourceListid,\n        cardids: U.removeItemAtIndexInArray(sourceCardidOrders, sourceCardIndex)\n      }));\n      const destinationCardidOrders = listidCardidOrders[destinationListid];\n      dispatch(LC.setListidCardids({\n        listid: destinationListid,\n        cardids: U.insertItemAtIndexInArray(destinationCardidOrders, destinationCardIndex, result.draggableId)\n      }));\n    }\n  }, [listidCardidOrders, dispatch]);\n  return {\n    lists,\n    onCreateList,\n    onRemoveList,\n    onMoveList,\n    onDragEnd\n  };\n};\n_s(useLists, \"UlvOT/6Hd2JfayKuoyTl+0vjsEY=\", false, function () {\n  return [useDispatch, useSelector, useSelector, useSelector];\n});","map":{"version":3,"names":["useCallback","useSelector","useDispatch","LO","L","C","LC","U","useLists","_s","dispatch","lists","listidOrders","listEntities","map","uuid","listidCardidOrders","onCreateList","title","list","addListidToOrders","addList","setListidCardids","listid","cardids","onRemoveList","forEach","cardid","removeCard","removeListid","removeList","removeListidFromOrders","onMoveList","dragIndex","hoverIndex","newOrders","item","index","setListidOrders","onDragEnd","result","_result$destination","_result$destination2","console","log","destinationListid","destination","droppableId","destinationCardIndex","undefined","sourceListid","source","sourceCardIndex","cardidOrders","swapItemsInArray","sourceCardidOrders","removeItemAtIndexInArray","destinationCardidOrders","insertItemAtIndexInArray","draggableId"],"sources":["C:/rcp/ch06/ch06_3/src/store/useList.ts"],"sourcesContent":["import type {DropResult} from \"react-beautiful-dnd\"\r\nimport {useCallback} from \"react\"\r\nimport {useSelector, useDispatch} from \"react-redux\"\r\nimport type {AppState} from \"../store\"\r\nimport type {List} from \"../store/commonTypes\"\r\nimport * as LO from \"../store/listidOrders\"\r\nimport * as L from \"../store/listEntities\"\r\nimport * as C from \"../store/cardEntities\"\r\nimport * as LC from \"../store/listidCardidOrders\"\r\nimport * as U from \"../utils\"\r\n\r\nexport const useLists = () => {\r\n  const dispatch = useDispatch()\r\n\r\n  const lists = useSelector<AppState, List[]>(({listidOrders, listEntities}) =>\r\n    listidOrders.map(uuid => listEntities[uuid])\r\n  )\r\n\r\n  const listidCardidOrders = useSelector<AppState, LC.State>(\r\n    ({listidCardidOrders}) => listidCardidOrders\r\n  )\r\n\r\n  const listidOrders = useSelector<AppState, LO.State>(({listidOrders}) => listidOrders)\r\n\r\n  const onCreateList = useCallback(\r\n    (uuid: string, title: string) => {\r\n      const list = {uuid, title}\r\n      dispatch(LO.addListidToOrders(uuid))\r\n      dispatch(L.addList(list))\r\n      dispatch(LC.setListidCardids({listid: list.uuid, cardids: []}))\r\n    },\r\n    [dispatch]\r\n  )\r\n\r\n  const onRemoveList = useCallback(\r\n    (listid: string) => () => {\r\n      listidCardidOrders[listid].forEach(cardid => {\r\n        dispatch(C.removeCard(cardid))\r\n      })\r\n      dispatch(LC.removeListid(listid))\r\n\r\n      dispatch(L.removeList(listid))\r\n      dispatch(LO.removeListidFromOrders(listid))\r\n    },\r\n    [dispatch, listidCardidOrders]\r\n  )\r\n\r\n  const onMoveList = useCallback(\r\n    (dragIndex: number, hoverIndex: number) => {\r\n      const newOrders = listidOrders.map((item, index) =>\r\n        index === dragIndex\r\n          ? listidOrders[hoverIndex]\r\n          : index === hoverIndex\r\n          ? listidOrders[dragIndex]\r\n          : item\r\n      )\r\n      dispatch(LO.setListidOrders(newOrders))\r\n    },\r\n    [dispatch, listidOrders]\r\n  )\r\n\r\n  const onDragEnd = useCallback(\r\n    (result: DropResult) => {\r\n      console.log(\"onDragEnd result\", result)\r\n      const destinationListid = result.destination?.droppableId\r\n      const destinationCardIndex = result.destination?.index\r\n      if (destinationListid === undefined || destinationCardIndex === undefined) return\r\n\r\n      const sourceListid = result.source.droppableId\r\n      const sourceCardIndex = result.source.index\r\n\r\n      if (destinationListid === sourceListid) {\r\n        const cardidOrders = listidCardidOrders[destinationListid]\r\n\r\n        dispatch(\r\n          LC.setListidCardids({\r\n            listid: destinationListid,\r\n            cardids: U.swapItemsInArray(\r\n              cardidOrders,\r\n              sourceCardIndex,\r\n              destinationCardIndex\r\n            )\r\n          })\r\n        )\r\n      } else {\r\n        const sourceCardidOrders = listidCardidOrders[sourceListid]\r\n        dispatch(\r\n          LC.setListidCardids({\r\n            listid: sourceListid,\r\n            cardids: U.removeItemAtIndexInArray(sourceCardidOrders, sourceCardIndex)\r\n          })\r\n        )\r\n        const destinationCardidOrders = listidCardidOrders[destinationListid]\r\n        dispatch(\r\n          LC.setListidCardids({\r\n            listid: destinationListid,\r\n            cardids: U.insertItemAtIndexInArray(\r\n              destinationCardidOrders,\r\n              destinationCardIndex,\r\n              result.draggableId\r\n            )\r\n          })\r\n        )\r\n      }\r\n    },\r\n    [listidCardidOrders, dispatch]\r\n  )\r\n  return {lists, onCreateList, onRemoveList, onMoveList, onDragEnd}\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}